
> [!info] 
> **Лекция 2**

## Событийная модель

### Событие

> [!def] 
> `Событие ИБ` - любое изменение состояния системы, которое может быть зафиксировано и имеет значение с точки зрения ИБ

### Атрибуты события

> [!list] 
> `Атрибуты события`. Любое событие обычно имеет следующие `атрибуты`, которые мы можем использовать для **анализа**:
> - Временная метка
> - Источник
> - Тип события
> - Субъект
> - Объект
> - Действие
> - Служебные поля

> [!example] 
> ![[Pasted image 20251023161056.png]]

## SIEM-системы

### SEM

> [!def] 
> `SEM (sec event management)` - системы управления событиями в реальном времени:
> - Сбор и агрегация событий из разнородных источников
> - Нормализация - приведение к единому формату
> - Корреляция - выявление взаимосвязей между событиями на основе правил

### SIM

> [!def] 
> `SIM (sec info management)` - системы управления событиями, нацеленная на долгосрочное хранение:
> - Долгосрочное хранение событий
> - Подготовка отчётов

### SIEM

> [!def] 
> `SIEM (sec info and event management)` - система, объединяющая в себе **SEM** и **SIM**

![[Pasted image 20251023161405.png]]

> [!def] 
> `SOC (sec operations center)` - ИБ-эксперты 24/7 следящие за SIEM.

### Источники событий

> [!list] 
> События поступают от различных компонентов инфры:
> - ОСи
> - Сетевые устройства
> - Серверы приложений и бд
> - Антивирусы и EDR
> - Облачные платформы
> - Системы Auth
> - Приложения и API

### Коллекторы

> [!problem] 
> `SIEM` не может напрямую подключиться к тысячам источников - это огромная нагрузка и дыра в ИБ

> [!solved] 
> Решение - использовать промежуточное звено - `коллектор`

> [!def] 
> Основные задачи коллектора:
> - Получение логов из подсистем сбора данных 
> - Буферизация
> - Предварительная обработка
> - Отправка в SIEM

### auditd

> [!tool] 
> `auditd` - демон линукса, логирующая события в журнал
> ![[Pasted image 20251023161924.png]]
> 

> [!list] 
> Формат событий в `auditd`:
> - type - тип событий
> - Время возникновения события
> - id (порядковый номер) события
> - Контекст

![[Pasted image 20251023162201.png]]

### Типы событий в auditd

> [!list] 
> Основные типы событий в `auditd`:
> - `login`
> - `daemon start/daemon end` (отдельный счётчик событий)
> - `config_change`
> - `syscall`
> - `proctitle` - заголовок процесса, выполнивший syscall
> - `cwd` - содержит единственное поле с полным путём к текущему рабочему каталогу процесса, выполнившего syscall
> - `execve` - команда запуска процесса
> - `sockaddr` - информация о сокете (присутствует только в событиях, связанных с операциями над ними)
> - `user_*, cred_*` - события стороннего ПО

### Windows EventLog

> [!tool] 
> `EventLog` - средство логирования событий Windows, в котором регистрируются события ОС.
> 
> ![[Pasted image 20251023162735.png]] 

### Windows Sysmon

> [!tool] 
> `Sysmon` - системная служба Windows, которая отдаёт подробные данные о событиях, сетевых подключениях и драйверах, изменениях файлов и тд
> ![[Pasted image 20251023162930.png]]

## Нормализация событий 

> [!problem] 
> Разные устройства и приложения генерируют логи в своих особенных форматах

> [!def] 
> `Нормализация` - процесс приведения к одному виду всех форматов событий

### Регулярные выражения

> [!tool] 
> Для нормализация часто используются регулярные выражения, которые позволяют решать задачу, но есть нюансы:
> - Писать регулярки для разбора событий сложно
> - Корректировать под изменившиесяя данные сложно
> - К парсингу одного и того же события можно подойти по-разному и возникают проблемы с поддержкой и оптимизацией
> - Низкая читаемость

### Правила нормализации

> [!attention] 
> На помощь приходят правила нормализации - правило, преобразующее сырые события в единый формат. Обычно правила нормализации пишут на специально разработанных для этого DSL языках.
> 
> ![[Pasted image 20251023163706.png]]

## Корреляция событий

> [!def] 
> `Правило корреляции` - набор условий, по которым возможно собрать цепочку событий в единую логически связанную активность, которая может быть свидетельством атаки или иного нарушения ИБ.

> [!important] 
> Правило корреляции описывает такие связки событий, а SIEM генерирует alert

### Типы правил

> [!list] 
> - `threshold-base` - alert при кол-ве
> - `sequence-base` - alert при определённой последовательности событий
> - `statisical anomaly` - alert при отклонение от статистического поведения субъекта
> - `list-based/blacklist` - alert при наличии команды/аргумента/... в blacklist-е
> - `composite rules` - комбинация правил выше

### Правила корреляции

> [!def] 
> `Правила корреляции` - классический Rule-based подход:
> - hardcoded conditions
> - основаны на известных (!) сценариях
> - требуют ручной настройки (тюнинга)
> - высокая точность при правильной настройке для известных паттернов

### Жизненный цикл правил корреляции

> [!list] 
> Жизненный цикл правил корреляций:
> - Проектирование
> - Реализация
> - Тестирование на исторических данных
> - Развёртывание и настройка
> - Мониторинг и обновление


## Специфика ML на событиях

> [!faq] 
> `ML-based` подход:
> - Обучается на **нормальном поведение** систем
> - Выявляет отклонения - статистически значимые аномалии
> - Не требует жёстких условий
> - Адаптируется со временем 
> - Работает с неизвестными угрозами

### Математика SIEM-систем

> [!important] 
> Бинарная классификация:
> 
> ![[Pasted image 20251023165300.png]]

> [!attention] 
> `FP` - очень плохо

## Подходы к ML

![[Pasted image 20251023170408.png]]
![[Pasted image 20251023170438.png]]

### Метамодели


> [!tool] 
> `Метамодели-профайлеры` в виде моделей, которые на основе вердиктов низкоуровневых моделей оценки событий, могут выдавать свой вердикт
> ![[Pasted image 20251023171200.png]]

![[Pasted image 20251023171615.png]]

### Графовые свёртки

> [!important] 
> `Графовая свёртка` - сбор и анализ всех аномалий и признаков дочерних узлов. Свёртку можно выполнить несколькими способами:
> - Усреднение признаков всех узлов в окрестности
> - Суммирование признаков всех узлов в окрестности
> - Выбор максимального значения из признаков всех узлов в окрестности

### Процесс валидации в обучении с графовыми свёртками

![[Pasted image 20251023172059.png]]

## Кластеризация в анализе событий

> [!list] 
> Не все популярные методы кластеризации хорошо применимы к задачам ИБ:
> - Вычислительная сложность (очень много данных)
> - Требование указать кол-во кластеров (а мы не знаем скока)
> - Аномалии (выбросы важны!)

### Кластеризация логов

> [!example]
> ![[Pasted image 20251023172340.png]]

### Регрессия в анализе событий


> [!attention] 
> Аналогично кластеризации, не каждый метод регрессии хорошо применим в ИБ:
> - Выбросы (одна мощная атака сместит линию регрессии)
> - Шум в данных (модель запомнит флуктукацию)
> - Не всегда можно найти применение 

### Применение регрессии

> [!important] 
> Что можно сделать полезного с помощью регрессии:
> - Предсказать число попыток для успешного входа
> - Предсказание объёма исходящего трафика
> - Предсказание числа запусков процессов

![[Pasted image 20251023175109.png]]