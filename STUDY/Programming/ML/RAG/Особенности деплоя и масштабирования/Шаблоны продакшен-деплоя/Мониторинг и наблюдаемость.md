```python
import prometheus_client
from prometheus_client import Counter, Histogram, Gauge

# Метрики
SEARCH_REQUESTS = Counter('rag_search_requests_total', 'Total search requests')
SEARCH_LATENCY = Histogram('rag_search_duration_seconds', 'Search latency')
ACTIVE_CONNECTIONS = Gauge('rag_active_connections', 'Active connections')

@app.middleware("http")
async def monitor_requests(request, call_next):
    start_time = time.time()
    SEARCH_REQUESTS.inc()
    ACTIVE_CONNECTIONS.inc()
    
    response = await call_next(request)
    
    process_time = time.time() - start_time
    SEARCH_LATENCY.observe(process_time)
    ACTIVE_CONNECTIONS.dec()
    
    return response
```