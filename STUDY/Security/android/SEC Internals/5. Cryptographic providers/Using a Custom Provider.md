
> [!important] 
> Хотя встроенные провайдеры Android покрывают большинство широко используемых криптографических примитивов, они не поддерживают некоторые более экзотические алгоритмы и даже некоторые новые стандарты. Как упоминалось в обсуждении архитектуры JCA, приложения Android могут регистрировать пользовательские провайдеры для собственного использования, но не могут влиять на системные провайдеры.

Одним из наиболее широко используемых и полнофункциональных провайдеров JCA является Bouncy Castle, который также является базой одного из встроенных провайдеров Android. Однако, как обсуждалось в разделе "Провайдер Bouncy Castle Android" на странице 137, версия, поставляемая с Android, имеет ряд удаленных алгоритмов.

Если вам нужно использовать любой из этих алгоритмов, вы можете попробовать просто включить полную библиотеку Bouncy Castle в свое приложение, но это может вызвать конфликты при загрузке классов, особенно на версиях Android до 3.0, которые не меняют имя пакета системного Bouncy Castle. Чтобы избежать этого, вы можете изменить корневой пакет библиотеки с помощью такого инструмента, как jarjar, или использовать Spongy Castle.

---
## **Spongy Castle**

> [!new] 
> Spongy Castle — это перепакованная версия Bouncy Castle. Она изменяет все имена пакетов с org.bouncycastle.* на org.spongycastle.*, чтобы избежать конфликтов загрузчиков классов, и меняет имя провайдера с BC на SC. Имена классов не меняются, поэтому API остается таким же, как и у Bouncy Castle.

Для использования Spongy Castle нужно просто зарегистрировать его в рамках JCA с использованием методов Security.addProvider() или Security.insertProviderAt(). Затем вы можете запросить алгоритмы, не реализованные встроенными провайдерами Android, просто передав имя алгоритма в соответствующий метод getInstance().

Чтобы явно запросить реализацию от Spongy Castle, передайте строку SC в качестве имени провайдера. Если вы включите библиотеку Spongy Castle в свое приложение, вы также можете напрямую использовать легковесный криптографический API Bouncy Castle (который часто более гибок), не проходя через классы JCA engine. Кроме того, некоторые криптографические операции, такие как подпись X.509 сертификата или создание S/MIME сообщения, не имеют соответствующих JCA API и могут выполняться только с использованием низкоуровневых API Bouncy Castle.

В листинге 5-21 показано, как зарегистрировать провайдера Spongy Castle и запросить реализацию Signature для RSA-PSS (изначально определенного в PKCS#1), который не поддерживается ни одним из встроенных JCA провайдеров Android.
```java
static {
    Security.insertProviderAt(
        new org.spongycastle.jce.provider.BouncyCastleProvider(), 1);
}

Signature sig = Signature.getInstance("SHA1withRSA/PSS", "SC");
```

---
---
Предыдущая глава [[Android JCA Providers]]
Раздел [[Cryptographic providers]]
Книга [[SEC Internals]]
