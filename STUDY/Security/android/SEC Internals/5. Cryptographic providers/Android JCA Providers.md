
> [!new] 
> Криптографические провайдеры Android основаны на JCA и следуют его архитектуре с некоторыми относительно незначительными исключениями. Хотя низкоуровневые компоненты Android напрямую используют нативные криптографические библиотеки (такие как OpenSSL), JCA является основным криптографическим API и используется как системными компонентами, так и сторонними приложениями.

В Android есть три основных JCA провайдера, которые включают реализации классов механизмов, описанных в предыдущем разделе, и два провайдера Java Secure Socket Extension (JSSE), которые реализуют функциональность SSL. (JSSE подробно обсуждается в главе 6.)

---
## Harmony’s Crypto Provider

> [!new] 
> Реализация библиотеки времени выполнения Java в Android происходит от закрытого проекта Apache Harmony, который также включает ограниченного провайдера JCA, просто называемого Crypto. Этот провайдер предоставляет реализации для базовых криптографических сервисов, таких как генерация случайных чисел, хеширование и цифровые подписи. Crypto всё ещё включён в Android для обеспечения обратной совместимости, но имеет наименьший приоритет среди всех провайдеров JCA, поэтому реализации классов механизмов из Crypto не возвращаются, если явно не запрашиваются.

![[Pasted image 20240806190117.png]]

---
## Android’s Bouncy Castle Provider

> [!new] 
> До версии Android 4.0 единственным полнофункциональным провайдером JCA в Android был провайдер Bouncy Castle. Провайдер Bouncy Castle является частью Bouncy Castle Crypto APIs, набора реализации криптографических алгоритмов и протоколов с открытым исходным кодом на языке Java.

Android включает модифицированную версию провайдера Bouncy Castle, которая основывается на основной версии с применением набора патчей, специфичных для Android. Эти патчи поддерживаются в исходном дереве Android и обновляются для каждой новой версии основного провайдера Bouncy Castle.
Классы механизмов и алгоритмы, поддерживаемые провайдером Bouncy Castle в Android версии 4.4.4 (на основе Bouncy Castle 1.49), перечислены в таблице 5-2.

![[Pasted image 20240806190313.png]]
![[Pasted image 20240806190328.png]]
![[Pasted image 20240806190339.png]]

---
## AndroidOpenSSL Provider

> [!new] 
> Хеш-алгоритмы в провайдере Bouncy Castle для Android были заменены на нативный код по соображениям производительности. Для дальнейшего улучшения криптографической производительности количество поддерживаемых классов механизмов и алгоритмов в нативном провайдере AndroidOpenSSL постоянно растет с каждой новой версией, начиная с версии 4.0.

Изначально AndroidOpenSSL использовался только для реализации SSL-сокетов, но начиная с Android 4.4 он охватывает большинство функций, предлагаемых Bouncy Castle. Поскольку это предпочитаемый провайдер (с наивысшим приоритетом 1), классы механизмов, которые не запрашивают явно Bouncy Castle, получают реализацию от провайдера AndroidOpenSSL. Как следует из названия, его криптографическая функциональность предоставляется библиотекой OpenSSL. Реализация провайдера использует JNI для связывания нативного кода OpenSSL с Java SPI классами, необходимыми для реализации провайдера JCA. Основная часть реализации находится в Java классе NativeCrypto, который вызывается большинством SPI классов.

AndroidOpenSSL является частью библиотеки libcore Android, которая реализует основную часть Java runtime библиотеки Android. Начиная с Android 4.4, AndroidOpenSSL был отделен от libcore, чтобы его можно было компилировать как отдельную библиотеку и включать в приложения, которые хотят иметь стабильную криптографическую реализацию, не зависящую от версии платформы. Отдельный провайдер называется Conscrypt и находится в пакете org.conscrypt, переименованном в com.android.org.conscrypt при сборке как часть платформы Android.

Классы механизмов и алгоритмы, поддерживаемые провайдером AndroidOpenSSL на версии 4.4.4, перечислены в таблице 5-3.

![[Pasted image 20240806190601.png]]
![[Pasted image 20240806190608.png]]

---
## OpenSSL

> [!new] 
> OpenSSL — это криптографический инструментарий с открытым исходным кодом, который реализует протоколы SSL и TLS и широко используется как универсальная криптографическая библиотека.17 Он включен в Android как системная библиотека и используется для реализации провайдера AndroidOpenSSL JCA.

Различные выпуски Android используют разные версии OpenSSL (в основном последнюю стабильную версию, которая в Android 4.4 — 1.0.1e), с набором применяемых патчей. Следовательно, Android не предлагает стабильный публичный API OpenSSL, поэтому приложения, которым нужно использовать OpenSSL, должны включать библиотеку и не ссылаться на системную версию. Единственный публичный криптографический API — это JCA, который предлагает стабильный интерфейс, отвязанный от внутренней реализации.

---
---
Предыдущая глава [[Классы двигателей JCA]]
Следующая глава [[Using a Custom Provider]]
Раздел [[Cryptographic providers]]
Книга [[SEC Internals]]
